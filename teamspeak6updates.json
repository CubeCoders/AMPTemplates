[
    {
        "UpdateStageName": "TeamSpeak 6 Server Download",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"ServerVersion=\\\"{{ServerVersion}}\\\"; cd ts6 && if [[ -x server/tsserver ]]; then InstalledVersion=$(server/tsserver --version); InstalledVersion=\\\"${InstalledVersion%% *}\\\"; else InstalledVersion=\\\"\\\"; [[ -z \\\"$ServerVersion\\\" ]] && ServerVersion=$(wget -qO- https://api.github.com/repos/teamspeak/teamspeak6-server/releases/latest | jq -r .name); if [[ ! \\\"$ServerVersion\\\" =~ ^v6\\.[0-9]+\\.[0-9]+\\(-beta\\d+\\)?$ ]]; then echo \\\"Invalid TeamSpeak 6 version format specified\\\" && exit 1; elif [[ \\\"$InstalledVersion\\\" == \\\"$ServerVersion\\\" ]]; then echo \\\"TeamSpeak 6 v$ServerVersion already installed. Skipping\\\" && exit 0; else [[ -f teamspeak6.tar.bz2 ]] && rm -f teamspeak6.tar.bz2 >/dev/null 2>&1; wget -qO teamspeak6.tar.bz2 https://github.com/teamspeak/teamspeak6-server/releases/download/$ServerVersion/teamspeak-server_linux_amd64-$ServerVersion.tar.bz2 || { echo \\\"Download failed from GitHub. Aborting\\\"; exit 1; }; tar -xzf teamspeak6.tar.bz2 -C server --strip-components=1 >/dev/null 2>&1 && rm -f teamspeak6.tar.bz2 >/dev/null 2>&1 && echo \\\"TeamSpeak 6 v$ServerVersion downloaded\\\"; fi\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "TeamSpeak 6 Server Download",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "Executable",
        "UpdateSourceData": "powershell.exe",
        "UpdateSourceArgs": "-NoProfile -Command \"$ProgressPreference='SilentlyContinue'; [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; $ServerVersion='{{ServerVersion}}'; Set-Location -Path 'ts6'; if (Test-Path 'server/tsserver.exe') { (& server/tsserver.exe --version) -split ' ' | Select-Object -First 1 } else { $InstalledVersion = '' }; if ( [string]::IsNullOrWhiteSpace($ServerVersion) ) { $ServerVersion = (Invoke-RestMethod -UseBasicParsing -Uri \\\"https://api.github.com/repos/teamspeak/teamspeak6-server/releases/latest\\\").name }; if ( $ServerVersion -notmatch '^v6\\.\\d+\\.\\d+\\(-beta\\d+\\)?$' ) { Write-Output 'Invalid MongoDB version format specified'; exit 1 } elseif ( $InstalledVersion -eq $ServerVersion ) { Write-Output \\\"MongoDB v$ServerVersion already installed. Skipping\\\"; exit 0 } else { if ( Test-Path teamspeak6.zip ) { Remove-Item teamspeak6.zip -Force -ErrorAction SilentlyContinue *> $null }; try { Invoke-WebRequest -UseBasicParsing -Uri https://fastdl.mongodb.org/windows/mongodb-windows-x86_64-$ServerVersion.zip -OutFile teamspeak6.zip -ErrorAction Stop } catch { Write-Output \\\"Download failed from the MongoDB CDN. This is a fault with the CDN, not AMP. Aborting\\\"; exit 1; }; Expand-Archive -Path \\\"teamspeak6.zip\\\" -DestinationPath \\\".\\\" -Force *> $null; if ( Test-Path teamspeak6.zip ) { Remove-Item teamspeak6.zip -Force -ErrorAction SilentlyContinue *> $null }; if (Test-Path \\\"mongodb-*\\\") { Remove-Item -Recurse -Force mongodb -ErrorAction SilentlyContinue *> $null; Get-ChildItem -Directory | Where-Object { $_.Name -like \\\"mongodb-*\\\" } | Rename-Item -NewName \\\"mongodb\\\" *> $null; Write-Output \\\"MongoDB v$ServerVersion downloaded\\\" } }\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "TeamSpeak 6 Server Download",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "FetchURLFromJQ",
        "UpdateSourceData": "https://api.github.com/repos/teamspeak/teamspeak6-server/releases/latest",
        "UpdateSourceArgs": "$.assets[1].browser_download_url",
        "UpdateSourceTarget": "{{$FullRootDir}}",
        "UnzipUpdateSource": true,
        "OverwriteExistingFiles": true,
        "DeleteAfterExtract": true,
        "UpdateSourceConditionSetting": "ServerStream",
        "UpdateSourceConditionValue": "latest",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "TeamSpeak 6 Server Download",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "FetchURLFromJQ",
        "UpdateSourceData": "https://api.github.com/repos/teamspeak/teamspeak6-server/releases/latest",
        "UpdateSourceArgs": "$.assets[0].browser_download_url",
        "UpdateSourceTarget": "{{$FullRootDir}}",
        "UnzipUpdateSource": true,
        "OverwriteExistingFiles": true,
        "DeleteAfterExtract": true,
        "UpdateSourceConditionSetting": "ServerStream",
        "UpdateSourceConditionValue": "latest",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "TeamSpeak 6 Server Download",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "FetchURL",
        "UpdateSourceData": "https://github.com/teamspeak/teamspeak6-server/releases/download/v{{SpecificServerVersion}}/teamspeak-server_win64-v{{SpecificServerVersion}}.zip",
        "UpdateSourceTarget": "{{$FullRootDir}}",
        "UnzipUpdateSource": true,
        "OverwriteExistingFiles": true,
        "DeleteAfterExtract": true,
        "UpdateSourceConditionSetting": "ServerStream",
        "UpdateSourceConditionValue": "specificversion",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "TeamSpeak 6 Server Download",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "FetchURL",
        "UpdateSourceData": "https://github.com/teamspeak/teamspeak6-server/releases/download/v{{SpecificServerVersion}}/teamspeak-server_linux_amd64-v{{SpecificServerVersion}}.tar.bz2",
        "UpdateSourceTarget": "{{$FullRootDir}}",
        "UnzipUpdateSource": true,
        "OverwriteExistingFiles": true,
        "DeleteAfterExtract": true,
        "UpdateSourceConditionSetting": "ServerStream",
        "UpdateSourceConditionValue": "specificversion",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Working Directory Replacement",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"cd ts6; rm -rf teamspeak3-server_win64 >/dev/null 2>&1; ln -s teamspeak3-server_linux_amd64 teamspeak3-server_win64\"",
        "SkipOnFailure": false
    }
]