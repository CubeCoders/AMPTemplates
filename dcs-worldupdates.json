[
    {
        "UpdateStageName": "Initialise Wine",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"export XDG_RUNTIME_DIR=/tmp/xdg_runtime_amp; export WINEARCH=win64 WINEDEBUG=-all; export WINEPREFIX=\\\"{{$FullRootDir}}.wine\\\"; /usr/bin/wineboot --init --update\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create Installation Directory",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "CreateDirectory",
        "UpdateSourceArgs": "{{$FullRootDir}}.wine/drive_c/DCSWorld/bin",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create Config Directory",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "CreateDirectory",
        "UpdateSourceArgs": "{{$FullRootDir}}.wine/drive_c/DCSWorld/Config",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create Saved Directory",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "CreateDirectory",
        "UpdateSourceArgs": "{{$FullRootDir}}.wine/drive_c/users/amp/Saved Games/DCS.dcs_serverrelease",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create lang.txt",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "CreateFile",
        "UpdateSourceArgs": "{{$FullRootDir}}.wine/drive_c/DCSWorld/Config/lang.cfg",
        "UpdateSourceData": "EN",
        "OverwriteExistingFiles": false,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create autoupdate.cfg",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "CreateFile",
        "UpdateSourceArgs": "{{$FullRootDir}}.wine/drive_c/DCSWorld/autoupdate.cfg",
        "UpdateSourceData": "{\"WARNING\": \"DO NOT EDIT this file. You may break your install!\", \"branch\": \"dcs_server.release\", \"arch\": \"x86_64\", \"lang\": \"EN\", \"modules\": [\"WWII-ARMOUR\", \"SUPERCARRIER\", \"WORLD\"], \"launch\": null}",
        "OverwriteExistingFiles": false,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create Symlinks",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"cd dcs-world/server && ln -sf \\\"../.wine/drive_c/DCSWorld\\\" ./ >/dev/null 2>&1 && ln -sf \\\"../.wine/drive_c/users/amp/Saved Games/DCS.dcs_serverrelease\\\" ./Saves >/dev/null 2>&1\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "DCS World Updater Download",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "FetchURL",
        "UpdateSourceData": "https://updates.digitalcombatsimulator.com/files/DCS_updater_64bit.zip",
        "UpdateSourceTarget": "{{$FullBaseDir}}DCSWorld/bin",
        "UnzipUpdateSource": true,
        "OverwriteExistingFiles": true,
        "DeleteAfterExtract": true,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "DCS World Installer Download",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "FetchURL",
        "UpdateSourceData": "https://www.digitalcombatsimulator.com/upload/iblock/e0e/anj9iu7zs26ikw81hj18obkxmyhqx2be/DCS_World_Server_modular.exe",
        "UpdateSourceTarget": "{{$FullBaseDir}}",
        "OverwriteExistingFiles": true,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Server Installation",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"export XDG_RUNTIME_DIR=/tmp/xdg_runtime_amp; export LANG=en_US.UTF-8; export LC_ALL=en_US.UTF-8; cd \\\"{{$FullRootDir}}.wine/drive_c/DCSWorld/bin\\\" && mv -f DCS_updater.exe DCS_updater_initial.exe && WINEPREFIX=\\\"{{$FullRootDir}}.wine\\\" WINEARCH=win64 WINEDEBUG=-all /usr/bin/wine DCS_updater_initial.exe --quiet update && mv -f DCS_updater_initial.exe DCS_updater.exe\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Base Server Installation",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "Executable",
        "UpdateSourceData": "powershell.exe",
        "UpdateSourceArgs": "-c \"cd dcs-world/server; if (!(Test-Path '{{$FullBaseDir}}DCSWorld')) { & ./DCS_World_Server_modular.exe /suppressmsgboxes /sp- /verysilent /lang=en /noicons /norestartapplications /type=compact /dir='{{$FullBaseDir}}DCSWorld' } else { exit 0 }\"",
        "SkipOnFailure": false
    }
]