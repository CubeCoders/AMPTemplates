[
    {
        "UpdateStageName": "Initialise Wine",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"export XDG_RUNTIME_DIR=/tmp/xdg_runtime_amp; export WINEARCH=win64 WINEDEBUG=-all; export WINEPREFIX=\\\"{{$FullRootDir}}.wine\\\"; /usr/bin/wineboot --init --update\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create Installation Directory",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "CreateDirectory",
        "UpdateSourceArgs": "{{$FullRootDir}}.wine/drive_c/DCSWorld/bin",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create Installation Directory",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "CreateDirectory",
        "UpdateSourceArgs": "{{$FullBaseDir}}DCSWorld/bin",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create Config Directory",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "CreateDirectory",
        "UpdateSourceArgs": "{{$FullRootDir}}.wine/drive_c/DCSWorld/Config",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create Config Directory",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "CreateDirectory",
        "UpdateSourceArgs": "{{$FullBaseDir}}DCSWorld/Config",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create Saved Directory",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "CreateDirectory",
        "UpdateSourceArgs": "{{$FullRootDir}}.wine/drive_c/users/amp/Saved Games/DCS.dcs_serverrelease",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create lang.cfg",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "CreateFile",
        "UpdateSourceArgs": "{{$FullRootDir}}.wine/drive_c/DCSWorld/Config/lang.cfg",
        "UpdateSourceData": "EN",
        "OverwriteExistingFiles": false,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create lang.cfg",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "CreateFile",
        "UpdateSourceArgs": "{{$FullBaseDir}}DCSWorld/Config/lang.cfg",
        "UpdateSourceData": "EN",
        "OverwriteExistingFiles": false,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create dcs_variant.txt",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "CreateFile",
        "UpdateSourceArgs": "{{$FullRootDir}}.wine/drive_c/DCSWorld/Config/dcs_variant.txt",
        "UpdateSourceData": "dcs_server.release",
        "OverwriteExistingFiles": false,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create dcs_variant.txt",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "CreateFile",
        "UpdateSourceArgs": "{{$FullBaseDir}}DCSWorld/Config/dcs_variant.txt",
        "UpdateSourceData": "dcs_server.release",
        "OverwriteExistingFiles": false,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create autoupdate.cfg",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "CreateFile",
        "UpdateSourceArgs": "{{$FullRootDir}}.wine/drive_c/DCSWorld/autoupdate.cfg",
        "UpdateSourceData": "{\n \"WARNING\": \"DO NOT EDIT this file. You may break your install!\",\n \"branch\": \"dcs_server.release\",\n \"arch\": \"x86_64\",\n \"lang\": \"EN\",\n \"modules\": [\n  \"WWII-ARMOUR\",\n  \"SUPERCARRIER\",\n  \"WORLD\"\n ],\n \"launch\": null\n}",
        "OverwriteExistingFiles": false,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create autoupdate.cfg",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "CreateFile",
        "UpdateSourceArgs": "{{$FullBaseDir}}DCSWorld/autoupdate.cfg",
        "UpdateSourceData": "{\n \"WARNING\": \"DO NOT EDIT this file. You may break your install!\",\n \"branch\": \"dcs_server.release\",\n \"arch\": \"x86_64\",\n \"lang\": \"EN\",\n \"modules\": [\n  \"WWII-ARMOUR\",\n  \"SUPERCARRIER\",\n  \"WORLD\"\n ],\n \"launch\": null\n}",
        "OverwriteExistingFiles": false,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create Symlinks",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"cd dcs-world/server && ln -sf \\\"../.wine/drive_c/DCSWorld\\\" ./ >/dev/null 2>&1 && ln -sf \\\"../.wine/drive_c/users/amp/Saved Games/DCS.dcs_serverrelease\\\" ./Saves >/dev/null 2>&1\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Saves Directory Creation",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "Executable",
        "UpdateSourceData": "powershell.exe",
        "UpdateSourceArgs": "-NoProfile -Command \"$savedGames = [Environment]::GetFolderPath('SavedGames'); $savesDir = Join-Path $savedGames 'DCS.dcs_serverrelease'; New-Item -ItemType Directory -Path $newDir -Force | Out-Null; cmd /c mklink /J \\\"{{$FullBaseDir}}Saves\\\" \\\"$savesDir\\\"\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "DCS World Updater Download",
        "UpdateSourcePlatform": "All",
        "UpdateSource": "FetchURL",
        "UpdateSourceData": "https://updates.digitalcombatsimulator.com/files/DCS_updater_64bit.zip",
        "UpdateSourceTarget": "{{$FullBaseDir}}DCSWorld/bin",
        "UnzipUpdateSource": true,
        "OverwriteExistingFiles": true,
        "DeleteAfterExtract": true,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Base Server Installation",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"export XDG_RUNTIME_DIR=/tmp/xdg_runtime_amp; export LANG=en_US.UTF-8; export LC_ALL=en_US.UTF-8; cd \\\"{{$FullRootDir}}.wine/drive_c/DCSWorld/bin\\\" && mv -f DCS_updater.exe DCS_updater_initial.exe && WINEPREFIX=\\\"{{$FullRootDir}}.wine\\\" WINEARCH=win64 WINEDEBUG=-all /usr/bin/wine DCS_updater_initial.exe --quiet update && mv -f DCS_updater_initial.exe DCS_updater.exe\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Base Server Installation",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "Executable",
        "UpdateSourceData": "powershell.exe",
        "UpdateSourceArgs": "-NoProfile -Command \"$ProgressPreference='SilentlyContinue'; [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; Set-Location -Path 'dcs-world/server/DCSWorld/bin'; Rename-Item -Path 'DCS_updater.exe' -NewName 'DCS_updater_initial.exe'; & ./DCS_updater_initial.exe --quiet update; Rename-Item -Path 'DCS_updater_initial.exe' -NewName 'DCS_updater.exe'\"",
        "SkipOnFailure": false
    }
]