[
    {
        "UpdateStageName": "Initialise Wine",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"export XDG_RUNTIME_DIR=/tmp/xdg_runtime_amp; unset DISPLAY WAYLAND_DISPLAY; export WINEARCH=win64 WINEDEBUG=-all WINEDLLOVERRIDES=\\\"mscoree,mshtml,winemenubuilder.exe=\\\"; export WINEPREFIX=\\\"{{$FullRootDir}}.wine\\\"; cd dcs-world; /usr/bin/wineboot --init --update; /usr/bin/wine reg add \\\"HKCU\\Software\\Wine\\\" /v \\\"Version\\\" /t REG_SZ /d \\\"win10\\\" /f >/dev/null; /usr/bin/wine reg add \\\"HKCU\\Software\\Wine\\Drivers\\\" /v \\\"Audio\\\" /t REG_SZ /d \\\"\\\" /f >/dev/null; /usr/bin/wine reg add \\\"HKCU\\Software\\Wine\\WineDbg\\\" /v \\\"ShowCrashDialog\\\" /t REG_DWORD /d 0 /f >/dev/null; /usr/bin/wine reg add \\\"HKCU\\Software\\Wine\\Drivers\\\" /v \\\"Graphics\\\" /t REG_SZ /d \\\"null\\\" /f >/dev/null; /usr/bin/wine reg add \\\"HKCU\\Software\\Wine\\DllOverrides\\\" /v \\\"mscoree\\\" /t REG_SZ /d \\\"\\\" /f >/dev/null; /usr/bin/wine reg add \\\"HKCU\\Software\\Wine\\DllOverrides\\\" /v \\\"mshtml\\\" /t REG_SZ /d \\\"\\\" /f >/dev/null; /usr/bin/wine reg add \\\"HKCU\\Software\\Wine\\DllOverrides\\\" /v \\\"winemenubuilder\\\" /t REG_SZ /d \\\"\\\" /f >/dev/null; /usr/bin/wine reg add \\\"HKCU\\Software\\Wine\\DllOverrides' /v wbemprox /t REG_SZ /d \\\"native\\\" /f >/dev/null; wget -q -N https://raw.githubusercontent.com/Winetricks/winetricks/master/src/winetricks && chmod +x winetricks; ./winetricks --unattended d3dcompiler_43 > winescript_log.txt 2>&1; ./winetricks --unattended d3dx11_43 >> winescript_log.txt 2>&1; ./winetricks --unattended  d3dcompiler_47 >> winescript_log.txt 2>&1; /usr/bin/wineboot --shutdown --force; /usr/bin/wineboot --kill --force\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create Installation Directory",
        "UpdateSourcePlatform": "All",
        "UpdateSource": "CreateDirectory",
        "UpdateSourceArgs": "{{$FullBaseDir}}DCSWorld/bin",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create Config Directory",
        "UpdateSourcePlatform": "All",
        "UpdateSource": "CreateDirectory",
        "UpdateSourceArgs": "{{$FullBaseDir}}DCSWorld/Config",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create lang.cfg",
        "UpdateSourcePlatform": "All",
        "UpdateSource": "CreateFile",
        "UpdateSourceArgs": "{{$FullBaseDir}}DCSWorld/Config/lang.cfg",
        "UpdateSourceData": "EN",
        "OverwriteExistingFiles": false,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create dcs_variant.txt",
        "UpdateSourcePlatform": "All",
        "UpdateSource": "CreateFile",
        "UpdateSourceArgs": "{{$FullBaseDir}}DCSWorld/Config/dcs_variant.txt",
        "UpdateSourceData": "dcs_server.release",
        "OverwriteExistingFiles": false,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Create autoupdate.cfg",
        "UpdateSourcePlatform": "All",
        "UpdateSource": "CreateFile",
        "UpdateSourceArgs": "{{$FullBaseDir}}DCSWorld/autoupdate.cfg",
        "UpdateSourceData": "{\n \"WARNING\": \"DO NOT EDIT this file. You may break your install!\",\n \"branch\": \"dcs_server.release\",\n \"arch\": \"x86_64\",\n \"lang\": \"EN\",\n \"modules\": [\n  \"WWII-ARMOUR\",\n  \"SUPERCARRIER\",\n  \"WORLD\"\n ],\n \"launch\": null\n}",
        "OverwriteExistingFiles": false,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Saves Directory Creation",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"mkdir -p \\\"{{$FullRootDir}}.wine/drive_c/users/amp/Saved Games/DCS.dcs_serverrelease\\\" >/dev/null 2>&1; cd dcs-world/server && ln -sf \\\"../.wine/drive_c/users/amp/Saved Games/DCS.dcs_serverrelease\\\" ./Saves >/dev/null 2>&1\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Saves Directory Creation",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "Executable",
        "UpdateSourceData": "powershell.exe",
        "UpdateSourceArgs": "-NoProfile -Command \"$savedGames = [Environment]::GetFolderPath('SavedGames'); $savesDir = Join-Path $savedGames 'DCS.dcs_serverrelease'; New-Item -ItemType Directory -Path $newDir -Force | Out-Null; cmd /c mklink /J \\\"{{$FullBaseDir}}Saves\\\" \\\"$savesDir\\\"\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "DCS World Updater Download",
        "UpdateSourcePlatform": "All",
        "UpdateSource": "FetchURL",
        "UpdateSourceData": "https://updates.digitalcombatsimulator.com/files/DCS_updater_64bit.zip",
        "UpdateSourceTarget": "{{$FullBaseDir}}DCSWorld/bin",
        "UnzipUpdateSource": true,
        "OverwriteExistingFiles": true,
        "DeleteAfterExtract": true,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Base Server Installation",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"export XDG_RUNTIME_DIR=/tmp/xdg_runtime_amp; export LANG=en_US.UTF-8; export LC_ALL=en_US.UTF-8; export WINEARCH=win64 WINEDEBUG=-all; export WINEPREFIX=\\\"{{$FullRootDir}}.wine\\\"; cd dcs-world/server/DCSWorld/bin && mv -f DCS_updater.exe DCS_updater_initial.exe && echo \\\"\\\" && echo \\\"Installing/updating DCS World. This may take a while ...\\\" && /usr/bin/xvfb-run -a wine DCS_updater_initial.exe --quiet update & while pgrep -f \\\"^Z:.*DCS_updater_initial\\.exe.*\\\" >/dev/null; do sleep 10; done; /usr/bin/wineboot --shutdown --force; /usr/bin/wineboot --kill --force; cd dcs-world/server/DCSWorld/bin && mv -f DCS_updater_initial.exe DCS_updater.exe\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Base Server Installation",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "Executable",
        "UpdateSourceData": "powershell.exe",
        "UpdateSourceArgs": "-NoProfile -Command \"$ProgressPreference='SilentlyContinue'; [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; Set-Location -Path 'dcs-world/server/DCSWorld/bin'; Rename-Item -Path 'DCS_updater.exe' -NewName 'DCS_updater_initial.exe'; Write-Host \\\"\\\"; Write-Host \\\"Installing/updating DCS World. This may take a while ...\\\"; & ./DCS_updater_initial.exe --quiet update; Rename-Item -Path 'DCS_updater_initial.exe' -NewName 'DCS_updater.exe'\"",
        "SkipOnFailure": false
    }
]