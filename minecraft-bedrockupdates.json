[
    {
        "UpdateStageName":"Allowlist.json Backup",
        "UpdateSourcePlatform":"All",
        "UpdateSource":"CopyFilePath",
        "UpdateSourceData":"{{$FullBaseDir}}allowlist.json.bak",
        "UpdateSourceArgs":"{{$FullBaseDir}}allowlist.json",
        "OverwriteExistingFiles":true,
        "SkipOnFailure":true
    },
    {
        "UpdateStageName":"Permissions.json Backup",
        "UpdateSourcePlatform":"All",
        "UpdateSource":"CopyFilePath",
        "UpdateSourceData":"{{$FullBaseDir}}permissions.json.bak",
        "UpdateSourceArgs":"{{$FullBaseDir}}permissions.json",
        "OverwriteExistingFiles":true,
        "SkipOnFailure":true
    },
    {
        "UpdateStageName":"Server Download",
        "UpdateSourcePlatform":"Windows",
        "UpdateSource":"Executable",
        "UpdateSourceData":"powershell.exe",
        "UpdateSourceArgs":"-NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -Command \"cd Minecraft; $DOWNLOAD_URL=((Invoke-WebRequest -UseBasicParsing -Uri 'https://www.minecraft.net/en-us/download/server/bedrock').Links | ? class -match 'btn' | ? href -match 'bin-win/bedrock' | select -ExpandProperty href); if (-not $DOWNLOAD_URL) { $DOWNLOAD_URL=((Invoke-WebRequest -UseBasicParsing -Uri 'https://raw.githubusercontent.com/Greelan/AMPTemplates/dev/minecraft-bedrockdownloadurl.json').Content | ConvertFrom-Json).Windows.Release } else { Write-Output 'success' }; Invoke-WebRequest -UseBasicParsing -Uri $DOWNLOAD_URL -OutFile 'bedrock_server.zip'; Expand-Archive -Path 'bedrock_server.zip' -DestinationPath '.' -Force; Remove-Item 'bedrock_server.zip' -Force\"",
        "UpdateSourceConditionSetting":"ServerStream",
        "UpdateSourceConditionValue":"release-latest",
        "SkipOnFailure":false
    },
    {
        "UpdateStageName":"Server Download",
        "UpdateSourcePlatform":"Linux",
        "UpdateSource":"Executable",
        "UpdateSourceData":"/bin/bash",
        "UpdateSourceArgs":"-c 'cd Minecraft && DOWNLOAD_URL=$(wget -qO- --user-agent=\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.$((1 + RANDOM % 4000)).212 Safari/537.36\" https://www.minecraft.net/en-us/download/server/bedrock | grep -o \"https://minecraft.azureedge.net/bin-linux/[^\\\"]*\") && [[ -z $DOWNLOAD_URL ]] && DOWNLOAD_URL=$(wget -qO- https://raw.githubusercontent.com/Greelan/AMPTemplates/dev/minecraft-bedrockdownloadurl.json | jq -r \".Linux.Release\"); wget -qO bedrock_server.zip $DOWNLOAD_URL && unzip -qo bedrock_server.zip && rm -rf bedrock_server.zip'",
        "UpdateSourceConditionSetting":"ServerStream",
        "UpdateSourceConditionValue":"release-latest",
        "SkipOnFailure":false
    },
    {
        "UpdateStageName":"Server Download",
        "UpdateSourcePlatform":"Windows",
        "UpdateSource":"Executable",
        "UpdateSourceData":"powershell.exe",
        "UpdateSourceArgs":"-NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -Command \"cd Minecraft; $DOWNLOAD_URL=((Invoke-WebRequest -UseBasicParsing -Uri 'https://www.minecraft.net/en-us/download/server/bedrock').Links | ? class -match 'btn' | ? href -match 'bin-win-preview/bedrock' | select -ExpandProperty href); if (-not $DOWNLOAD_URL) { $DOWNLOAD_URL=((Invoke-WebRequest -UseBasicParsing -Uri 'https://raw.githubusercontent.com/Greelan/AMPTemplates/dev/minecraft-bedrockdownloadurl.json').Content | ConvertFrom-Json).Windows.Preview } else { }; Invoke-WebRequest -UseBasicParsing -Uri $DOWNLOAD_URL -OutFile 'bedrock_server.zip'; Expand-Archive -Path 'bedrock_server.zip' -DestinationPath '.' -Force; Remove-Item 'bedrock_server.zip' -Force\"",
        "UpdateSourceConditionSetting":"ServerStream",
        "UpdateSourceConditionValue":"preview-latest",
        "SkipOnFailure":false
    },
    {
        "UpdateStageName":"Server Download",
        "UpdateSourcePlatform":"Linux",
        "UpdateSource":"Executable",
        "UpdateSourceData":"/bin/bash",
        "UpdateSourceArgs":"-c 'cd Minecraft && DOWNLOAD_URL=$(wget -qO- --user-agent=\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.$((1 + RANDOM % 4000)).212 Safari/537.36\" https://www.minecraft.net/en-us/download/server/bedrock | grep -o \"https://minecraft.azureedge.net/bin-linux-preview/[^\\\"]*\") && [[ -z $DOWNLOAD_URL ]] && DOWNLOAD_URL=$(wget -qO- https://raw.githubusercontent.com/Greelan/AMPTemplates/dev/minecraft-bedrockdownloadurl.json | jq -r \".Linux.Preview\"); wget -qO bedrock_server.zip $DOWNLOAD_URL && unzip -qo bedrock_server.zip && rm -rf bedrock_server.zip'",
        "UpdateSourceConditionSetting":"ServerStream",
        "UpdateSourceConditionValue":"preview-latest",
        "SkipOnFailure":false
    },
    {
        "UpdateStageName":"Server Download",
        "UpdateSourcePlatform":"Windows",
        "UpdateSource":"FetchURL",
        "UpdateSourceData":"https://minecraft.azureedge.net/bin-win/bedrock-server-{{SpecificServerVersion}}.zip",
        "UpdateSourceTarget":"{{$FullBaseDir}}",
        "UnzipUpdateSource":true,
        "OverwriteExistingFiles":true,
        "DeleteAfterExtract":true,
        "UpdateSourceConditionSetting":"ServerStream",
        "UpdateSourceConditionValue":"release-specificversion"
    },
    {
        "UpdateStageName":"Server Download",
        "UpdateSourcePlatform":"Linux",
        "UpdateSource":"FetchURL",
        "UpdateSourceData":"https://minecraft.azureedge.net/bin-linux/bedrock-server-{{SpecificServerVersion}}.zip",
        "UpdateSourceTarget":"{{$FullBaseDir}}",
        "UnzipUpdateSource":true,
        "OverwriteExistingFiles":true,
        "DeleteAfterExtract":true,
        "UpdateSourceConditionSetting":"ServerStream",
        "UpdateSourceConditionValue":"release-specificversion"
    },
    {
        "UpdateStageName":"Server Download",
        "UpdateSourcePlatform":"Windows",
        "UpdateSource":"FetchURL",
        "UpdateSourceData":"https://minecraft.azureedge.net/bin-win-preview/bedrock-server-{{SpecificServerVersion}}.zip",
        "UpdateSourceTarget":"{{$FullBaseDir}}",
        "UnzipUpdateSource":true,
        "OverwriteExistingFiles":true,
        "DeleteAfterExtract":true,
        "UpdateSourceConditionSetting":"ServerStream",
        "UpdateSourceConditionValue":"preview-specificversion"
    },
    {
        "UpdateStageName":"Server Download",
        "UpdateSourcePlatform":"Linux",
        "UpdateSource":"FetchURL",
        "UpdateSourceData":"https://minecraft.azureedge.net/bin-linux-preview/bedrock-server-{{SpecificServerVersion}}.zip",
        "UpdateSourceTarget":"{{$FullBaseDir}}",
        "UnzipUpdateSource":true,
        "OverwriteExistingFiles":true,
        "DeleteAfterExtract":true,
        "UpdateSourceConditionSetting":"ServerStream",
        "UpdateSourceConditionValue":"preview-specificversion"
    },
    {
        "UpdateStageName":"Make Server Executable",
        "UpdateSourcePlatform":"Linux",
        "UpdateSource":"SetExecutableFlag",
        "UpdateSourceArgs":"{{$FullBaseDir}}bedrock_server"
    },
    {
        "UpdateStageName":"Allowlist.json Restore",
        "UpdateSourcePlatform":"All",
        "UpdateSource":"CopyFilePath",
        "UpdateSourceData":"{{$FullBaseDir}}allowlist.json",
        "UpdateSourceArgs":"{{$FullBaseDir}}allowlist.json.bak",
        "OverwriteExistingFiles":true,
        "SkipOnFailure":true
    },
    {
        "UpdateStageName":"Permissions.json Restore",
        "UpdateSourcePlatform":"All",
        "UpdateSource":"CopyFilePath",
        "UpdateSourceData":"{{$FullBaseDir}}permissions.json",
        "UpdateSourceArgs":"{{$FullBaseDir}}permissions.json.bak",
        "OverwriteExistingFiles":true,
        "SkipOnFailure":true
    }
]
